<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Báº£ng quáº£n trá»‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="/css/dashboard.css" />
  </head>
  <body>
    <header class="navbar">
      <a href="/dashboard" class="logo">
        <img src="https://bknet.edu.vn/wp-content/uploads/2024/06/logo-bknet-2024.png" alt="Valorant" />
      </a>
      <div id="user-info">ğŸ‘‹ Xin chÃ o Admin...</div>
      <a href="/auth/logout" class="btn-logout">ÄÄƒng xuáº¥t</a>
    </header>

    <aside class="sidebar">
      <ul>
        <li><a href="#" data-page="home"><i class="fas fa-home"></i> Trang chá»§</a></li>
        <li><a href="#" data-page="maps"><i class="fas fa-map"></i> Quáº£n lÃ½ Báº£n Äá»“</a></li>
        <li><a href="#" data-page="roles"><i class="fas fa-shield-alt"></i> Quáº£n lÃ½ Roles</a></li>
        <li><a href="#" data-page="agents"><i class="fas fa-users"></i> Quáº£n lÃ½ Agents</a></li>
        <li><a href="#" data-page="admin"><i class="fas fa-user-shield"></i> Quáº£n lÃ½ Admin</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <section id="content-area" class="welcome-card">
        <h2>ChÃ o má»«ng báº¡n Ä‘áº¿n trang quáº£n trá»‹!</h2>
        <p>Chá»n má»™t má»¥c á»Ÿ menu bÃªn trÃ¡i Ä‘á»ƒ báº¯t Ä‘áº§u.</p>
      </section>
    </main>

    <script>
      const userInfo = document.getElementById("user-info");
      const contentArea = document.getElementById("content-area");
      const pageScripts = {
        admin: { src: "/js/admin/admin.js", id: "admin-module" },
        agents: { src: "/js/agents/agents.js", id: "agents-module" },
        roles: { src: "/js/agents/roles.js", id: "roles-module" },
        maps: { src: "/js/agents/maps.js", id: "maps-module" },
      };

      const loadUser = async () => {
        try {
          const response = await fetch("/api/admin/me");
          if (!response.ok) throw new Error("Unauthorized");
          const user = await response.json();
          userInfo.innerHTML = `ğŸ‘‹ Xin chÃ o <b>${user.username}</b>`;
        } catch {
          userInfo.textContent = "Báº¡n chÆ°a Ä‘Äƒng nháº­p.";
        }
      };

      const attachScript = (config) => {
        if (!config) return;
        const existing = document.getElementById(config.id);
        if (existing) {
          existing.remove();
        }
        const script = document.createElement("script");
        script.src = config.src;
        script.id = config.id;
        document.body.appendChild(script);
      };

      const loadPage = async (page) => {
        if (page === "home") {
          contentArea.className = "welcome-card";
          contentArea.innerHTML = "<h2>Trang chá»§</h2><p>ChÃ o má»«ng quay láº¡i!</p>";
          return;
        }

        try {
          const response = await fetch(`/pages/${page}`);
          if (!response.ok) throw new Error("Not Found");
          const html = await response.text();
          contentArea.className = "page-container";
          contentArea.innerHTML = html;
          attachScript(pageScripts[page]);
        } catch (error) {
          contentArea.className = "page-container";
          contentArea.innerHTML =
            "<p class='error-text'>KhÃ´ng thá»ƒ táº£i ná»™i dung. Vui lÃ²ng thá»­ láº¡i sau.</p>";
        }
      };

      document.querySelectorAll(".sidebar a").forEach((link) => {
        link.addEventListener("click", (event) => {
          event.preventDefault();
          const page = event.currentTarget.dataset.page;
          loadPage(page);
        });
      });

      loadUser();
    </script>
  </body>
</html>
